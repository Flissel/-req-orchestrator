# C4 Architecture: Requirements Mining & Validation Conversation Flow

## Overview
This C4 diagram illustrates the complete conversation flow between user, frontend, backend services, and LLM agents throughout the requirements mining and validation process, including user clarifications and multi-agent orchestration.

---

## Level 1: System Context Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Requirements Mining Platform                         â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                â”‚
â”‚  â”‚   User   â”‚  Uploads documents, provides clarifications,                  â”‚
â”‚  â”‚          â”‚  triggers validation, reviews results                         â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                                â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â†“                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚              React Frontend (Browser)                        â”‚            â”‚
â”‚  â”‚  - Upload Interface                                          â”‚            â”‚
â”‚  â”‚  - Real-time Chat (Agent Messages)                          â”‚            â”‚
â”‚  â”‚  - Clarification Modals                                     â”‚            â”‚
â”‚  â”‚  - Requirements Visualization                               â”‚            â”‚
â”‚  â”‚  - Batch Validation Controls                                â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                          â”‚ HTTP + SSE                                       â”‚
â”‚                          â†“                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚           FastAPI Backend + Agent Orchestration              â”‚            â”‚
â”‚  â”‚  - File Upload & Processing                                 â”‚            â”‚
â”‚  â”‚  - Master Workflow Orchestration                            â”‚            â”‚
â”‚  â”‚  - Multi-Agent Conversation Management                      â”‚            â”‚
â”‚  â”‚  - Validation Service (10 Criterion Agents)                 â”‚            â”‚
â”‚  â”‚  - SSE Event Streaming                                      â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                          â”‚ API Calls                                        â”‚
â”‚                          â†“                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚              OpenAI LLM API (GPT-4)                         â”‚            â”‚
â”‚  â”‚  - Requirement Extraction                                   â”‚            â”‚
â”‚  â”‚  - Quality Evaluation                                       â”‚            â”‚
â”‚  â”‚  - Auto-Fix Generation                                      â”‚            â”‚
â”‚  â”‚  - Knowledge Graph Extraction                               â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Level 2: Container Diagram - Complete Process Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Requirements Mining & Validation Flow                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USER                    FRONTEND                 BACKEND                    AGENTS
 â”‚                         â”‚                         â”‚                         â”‚
 â”‚  1. Upload Document     â”‚                         â”‚                         â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚                         â”‚
 â”‚  (requirements.pdf)     â”‚                         â”‚                         â”‚
 â”‚                         â”‚                         â”‚                         â”‚
 â”‚  2. Select Model &      â”‚                         â”‚                         â”‚
 â”‚     Configuration       â”‚                         â”‚                         â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚                         â”‚
 â”‚  (gpt-4o, chunk_size)   â”‚                         â”‚                         â”‚
 â”‚                         â”‚                         â”‚                         â”‚
 â”‚  3. Click "Start        â”‚  POST /api/arch_team/   â”‚                         â”‚
 â”‚     Mining"             â”‚  process                â”‚                         â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚  Master Workflow        â”‚
 â”‚                         â”‚  FormData:              â”‚  Initialized            â”‚
 â”‚                         â”‚  - files                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                         â”‚  - model                â”‚  session_id generated   â”‚
 â”‚                         â”‚  - correlation_id       â”‚                         â”‚
 â”‚                         â”‚  - chunk_size           â”‚                         â”‚
 â”‚                         â”‚  - use_llm_kg           â”‚                         â”‚
 â”‚                         â”‚                         â”‚                         â”‚
 â”‚                         â”‚  SSE Stream Connected   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
 â”‚                         â”‚  /api/arch_team/stream/ â”‚  â”‚ ChunkMiner Agent â”‚  â”‚
 â”‚                         â”‚  {session_id}           â”‚  â”‚ - Extract text   â”‚  â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚ - Chunk document â”‚  â”‚
 â”‚  4. Real-Time Updates   â”‚                         â”‚  â”‚ - Mine REQs      â”‚  â”‚
 â”‚  (Agent Messages)       â”‚  SSE Events:            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  - agent_message        â”‚            â”‚            â”‚
 â”‚  "ChunkMiner: Found     â”‚  - chunk_processed      â”‚            â”‚            â”‚
 â”‚   15 requirements"      â”‚  - requirement_mined    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
 â”‚                         â”‚                         â”‚  REQs with heuristic    â”‚
 â”‚                         â”‚                         â”‚  validation (3/10)      â”‚
 â”‚                         â”‚                         â”‚                         â”‚
 â”‚                         â”‚                         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
 â”‚                         â”‚                         â”‚  â”‚ KG Agent         â”‚  â”‚
 â”‚                         â”‚                         â”‚  â”‚ - Extract nodes  â”‚  â”‚
 â”‚                         â”‚  SSE Events:            â”‚  â”‚ - Extract edges  â”‚  â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  - kg_node_added        â”‚  â”‚ - Build graph    â”‚  â”‚
 â”‚  "KG Agent: Building    â”‚  - kg_edge_added        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
 â”‚   knowledge graph..."   â”‚                         â”‚            â”‚            â”‚
 â”‚                         â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
 â”‚                         â”‚                         â”‚  KG data ready          â”‚
 â”‚                         â”‚                         â”‚                         â”‚
 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                         â”‚
 â”‚  â”‚ 5. CLARIFICATION REQUEST MODAL               â”‚ â”‚                         â”‚
 â”‚  â”‚ (Master Agent needs user input)              â”‚ â”‚                         â”‚
 â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚                         â”‚
 â”‚  â”‚ "The document mentions 'security level'.    â”‚ â”‚                         â”‚
 â”‚  â”‚  Which level should be enforced?"           â”‚ â”‚                         â”‚
 â”‚  â”‚                                              â”‚ â”‚                         â”‚
 â”‚  â”‚  Input: ___________________________         â”‚ â”‚                         â”‚
 â”‚  â”‚                                              â”‚ â”‚                         â”‚
 â”‚  â”‚  [Skip]              [Submit]               â”‚ â”‚                         â”‚
 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                         â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚                         â”‚
 â”‚  SSE Event:             â”‚                         â”‚  Master Agent paused,   â”‚
 â”‚  - clarification_needed â”‚                         â”‚  waiting for input      â”‚
 â”‚    {question, id}       â”‚                         â”‚                         â”‚
 â”‚                         â”‚                         â”‚                         â”‚
 â”‚  6. User Provides       â”‚  POST /api/arch_team/   â”‚                         â”‚
 â”‚     Clarification       â”‚  clarify                â”‚                         â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚  Resume workflow        â”‚
 â”‚  "Use ISO 27001 Level 2"â”‚  {clarification_id,     â”‚  with user input        â”‚
 â”‚                         â”‚   user_input}           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                         â”‚                         â”‚  Master Agent continues â”‚
 â”‚                         â”‚                         â”‚                         â”‚
 â”‚                         â”‚  SSE Events:            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  - clarification_       â”‚  â”‚ Requirements     â”‚  â”‚
 â”‚  "Processing with       â”‚    resolved             â”‚  â”‚ Agent            â”‚  â”‚
 â”‚   user input..."        â”‚  - agent_message        â”‚  â”‚ - Refine REQs    â”‚  â”‚
 â”‚                         â”‚                         â”‚  â”‚ - Apply context  â”‚  â”‚
 â”‚                         â”‚                         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
 â”‚                         â”‚                         â”‚            â”‚            â”‚
 â”‚                         â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
 â”‚                         â”‚                         â”‚  REQs updated with      â”‚
 â”‚                         â”‚                         â”‚  clarification          â”‚
 â”‚                         â”‚                         â”‚                         â”‚
 â”‚  7. Workflow Complete   â”‚  HTTP 200 Response      â”‚                         â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  Final results          â”‚
 â”‚  Results displayed:     â”‚  {                      â”‚  compiled               â”‚
 â”‚  - 15 requirements      â”‚    success: true,       â”‚                         â”‚
 â”‚  - KG with 45 nodes     â”‚    requirements: [...], â”‚                         â”‚
 â”‚  - Validation summary   â”‚    kg_data: {...},      â”‚                         â”‚
 â”‚                         â”‚    validation_results   â”‚                         â”‚
 â”‚                         â”‚  }                      â”‚                         â”‚
 â”‚                         â”‚                         â”‚                         â”‚
 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                         â”‚
 â”‚  â”‚ 8. BATCH VALIDATION QUEUE                    â”‚ â”‚                         â”‚
 â”‚  â”‚ (7 requirements with score < 0.7)            â”‚ â”‚                         â”‚
 â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚                         â”‚
 â”‚  â”‚ ğŸ”§ Requirements Need Improvement     [7]    â”‚ â”‚                         â”‚
 â”‚  â”‚                                              â”‚ â”‚                         â”‚
 â”‚  â”‚ 7 requirements have quality scores           â”‚ â”‚                         â”‚
 â”‚  â”‚ below 0.7 threshold                          â”‚ â”‚                         â”‚
 â”‚  â”‚                                              â”‚ â”‚                         â”‚
 â”‚  â”‚ â± Estimated time: ~21 seconds               â”‚ â”‚                         â”‚
 â”‚  â”‚                                              â”‚ â”‚                         â”‚
 â”‚  â”‚              [Fix All (7)]                   â”‚ â”‚                         â”‚
 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                         â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚                         â”‚
 â”‚  BatchValidationButton  â”‚                         â”‚                         â”‚
 â”‚  appears automatically  â”‚                         â”‚                         â”‚
 â”‚                         â”‚                         â”‚                         â”‚
 â”‚  9. User Triggers       â”‚                         â”‚                         â”‚
 â”‚     Batch Validation    â”‚                         â”‚                         â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚  BatchValidationModal   â”‚                         â”‚
 â”‚  Click "Fix All (7)"    â”‚  opens                  â”‚                         â”‚
 â”‚                         â”‚                         â”‚                         â”‚
 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                         â”‚
 â”‚  â”‚ BATCH VALIDATION MODAL                       â”‚ â”‚                         â”‚
 â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚                         â”‚
 â”‚  â”‚ ğŸ”§ Batch Validation                          â”‚ â”‚                         â”‚
 â”‚  â”‚ Validating 1/7...                            â”‚ â”‚                         â”‚
 â”‚  â”‚                                              â”‚ â”‚                         â”‚
 â”‚  â”‚ Progress: [â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘] 14%                  â”‚ â”‚                         â”‚
 â”‚  â”‚ âœ“ Passed: 0  âœ— Failed: 0  âš¡ Split: 0        â”‚ â”‚                         â”‚
 â”‚  â”‚                                              â”‚ â”‚                         â”‚
 â”‚  â”‚ Currently validating:                        â”‚ â”‚                         â”‚
 â”‚  â”‚ REQ-001 - System shall authenticate users... â”‚ â”‚                         â”‚
 â”‚  â”‚                                              â”‚ â”‚                         â”‚
 â”‚  â”‚ ğŸ“‹ Event Log                                 â”‚ â”‚                         â”‚
 â”‚  â”‚ [14:32:15] Validating REQ-001...            â”‚ â”‚                         â”‚
 â”‚  â”‚                                              â”‚ â”‚                         â”‚
 â”‚  â”‚ [â¸ Pause]           [Cancel]                â”‚ â”‚                         â”‚
 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                         â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚                         â”‚
 â”‚                         â”‚                         â”‚                         â”‚
 â”‚                         â”‚  SSE Stream Connected   â”‚                         â”‚
 â”‚                         â”‚  /api/v1/validation/    â”‚                         â”‚
 â”‚                         â”‚  stream/{session_id}    â”‚                         â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚
 â”‚                         â”‚                         â”‚                         â”‚
 â”‚  10. Sequential         â”‚  For Each Requirement:  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
 â”‚      Validation         â”‚  POST /api/v1/validate/ â”‚  â”‚ Requirement      â”‚  â”‚
 â”‚      (REQ-001)          â”‚  auto                   â”‚  â”‚ Orchestrator     â”‚  â”‚
 â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚  â”‚ Coordinates      â”‚  â”‚
 â”‚                         â”‚  {                      â”‚  â”‚ 10 Specialists   â”‚  â”‚
 â”‚                         â”‚    requirement_id,      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
 â”‚                         â”‚    requirement_text,    â”‚            â”‚            â”‚
 â”‚                         â”‚    session_id,          â”‚            â†“            â”‚
 â”‚                         â”‚    threshold: 0.7,      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
 â”‚                         â”‚    max_iterations: 3    â”‚  â”‚ Specificity      â”‚  â”‚
 â”‚                         â”‚  }                      â”‚  â”‚ Agent            â”‚  â”‚
 â”‚                         â”‚                         â”‚  â”‚ - Evaluate       â”‚  â”‚
 â”‚                         â”‚  SSE Events:            â”‚  â”‚ - Suggest fix    â”‚  â”‚
 â”‚  11. Real-Time          â”‚  - requirement_updated  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
 â”‚      Criterion Fixes    â”‚    {criterion,          â”‚            â”‚            â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     old_text,           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
 â”‚  [14:32:17] Fixed       â”‚     new_text,           â”‚  score: 0.42 â†’ 0.85     â”‚
 â”‚  Specificity:           â”‚     score_before,       â”‚                         â”‚
 â”‚  0.42 â†’ 0.85            â”‚     score_after}        â”‚            â†“            â”‚
 â”‚                         â”‚                         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
 â”‚  [14:32:18] Fixed       â”‚  - requirement_updated  â”‚  â”‚ Testability      â”‚  â”‚
 â”‚  Testability:           â”‚    {criterion,          â”‚  â”‚ Agent            â”‚  â”‚
 â”‚  0.58 â†’ 0.91            â”‚     ...}                â”‚  â”‚ - Evaluate       â”‚  â”‚
 â”‚                         â”‚                         â”‚  â”‚ - Suggest fix    â”‚  â”‚
 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
 â”‚  â”‚ ğŸ”„ Applied Fixes                             â”‚ â”‚            â”‚            â”‚
 â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
 â”‚  â”‚ REQ-001 - Specificity  42% â†’ 85% âœ“          â”‚ â”‚  score: 0.58 â†’ 0.91     â”‚
 â”‚  â”‚                                              â”‚ â”‚                         â”‚
 â”‚  â”‚ [Diff View]                                  â”‚ â”‚            â”‚            â”‚
 â”‚  â”‚ - System shall authenticate users           â”‚ â”‚  All 10 agents run      â”‚
 â”‚  â”‚ + System shall authenticate users using     â”‚ â”‚  sequentially          â”‚
 â”‚  â”‚   OAuth 2.0 with MFA, ensuring secure       â”‚ â”‚            â”‚            â”‚
 â”‚  â”‚   access to protected resources             â”‚ â”‚            â†“            â”‚
 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚  â”‚ Atomic Agent     â”‚  â”‚
 â”‚                         â”‚                         â”‚  â”‚ SPLIT DETECTED!  â”‚  â”‚
 â”‚  12. Split Detection    â”‚  SSE Event:             â”‚  â”‚ - 1 req â†’ 2 reqs â”‚  â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  - requirement_split    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
 â”‚  [14:32:19] Split into  â”‚    {                    â”‚            â”‚            â”‚
 â”‚  2 requirements:        â”‚      original_id,       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
 â”‚  REQ-001-A, REQ-001-B   â”‚      new_requirement_   â”‚  new_ids: [REQ-001-A,   â”‚
 â”‚                         â”‚      ids: [...]         â”‚            REQ-001-B]   â”‚
 â”‚                         â”‚    }                    â”‚                         â”‚
 â”‚                         â”‚                         â”‚            â†“            â”‚
 â”‚  13. Validation         â”‚  SSE Event:             â”‚  Final score calculated â”‚
 â”‚      Complete           â”‚  - validation_complete  â”‚  across all criteria    â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    {                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚  [14:32:20] Completed   â”‚      requirement_id,    â”‚  {                      â”‚
 â”‚  REQ-001: Score 88%     â”‚      final_score: 0.88, â”‚    final_score: 0.88,   â”‚
 â”‚  (PASS)                 â”‚      passed: true,      â”‚    passed: true,        â”‚
 â”‚                         â”‚      total_fixes: 5,    â”‚    total_fixes: 5,      â”‚
 â”‚                         â”‚      split_occurred     â”‚    split_occurred: true â”‚
 â”‚                         â”‚    }                    â”‚  }                      â”‚
 â”‚                         â”‚                         â”‚                         â”‚
 â”‚  14. Move to Next       â”‚  Progress: 1/7 â†’ 2/7    â”‚                         â”‚
 â”‚      Requirement        â”‚  Stats: âœ“1 âœ—0 âš¡1       â”‚                         â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚  Validate REQ-002...    â”‚
 â”‚  Currently validating:  â”‚  POST /api/v1/validate/ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚  REQ-002 - The         â”‚  auto (REQ-002)         â”‚  Orchestrator starts    â”‚
 â”‚  application must...    â”‚                         â”‚  again for REQ-002      â”‚
 â”‚                         â”‚                         â”‚                         â”‚
 â”‚  [Repeat steps 11-14    â”‚  [Repeat for each       â”‚  [Process all 7         â”‚
 â”‚   for 6 more REQs]      â”‚   requirement]          â”‚   requirements]         â”‚
 â”‚                         â”‚                         â”‚                         â”‚
 â”‚  15. Batch Complete     â”‚  All 7 validated        â”‚                         â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚  Final stats            â”‚
 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  compiled               â”‚
 â”‚  â”‚ Batch validation completed                   â”‚ â”‚                         â”‚
 â”‚  â”‚ Progress: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100%                  â”‚ â”‚                         â”‚
 â”‚  â”‚ âœ“ Passed: 5  âœ— Failed: 2  âš¡ Split: 1        â”‚ â”‚                         â”‚
 â”‚  â”‚                                              â”‚ â”‚                         â”‚
 â”‚  â”‚                          [Close]             â”‚ â”‚                         â”‚
 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                         â”‚
 â”‚                         â”‚                         â”‚                         â”‚
 â”‚  16. Close Modal        â”‚  onBatchComplete()      â”‚                         â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚  callback               â”‚                         â”‚
 â”‚                         â”‚  - Update all REQs      â”‚                         â”‚
 â”‚                         â”‚  - Refresh scores       â”‚                         â”‚
 â”‚                         â”‚  - Show split badges    â”‚                         â”‚
 â”‚                         â”‚                         â”‚                         â”‚
 â”‚  17. Updated UI         â”‚                         â”‚                         â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚                         â”‚
 â”‚  Requirements List:     â”‚                         â”‚                         â”‚
 â”‚  â”œâ”€ REQ-001-A âœ“ 88%    â”‚  Green badge (passed)   â”‚                         â”‚
 â”‚  â”œâ”€ REQ-001-B âš¡âœ“ 92%   â”‚  Orange+Green (split)   â”‚                         â”‚
 â”‚  â”œâ”€ REQ-002 âœ“ 85%      â”‚  Green badge            â”‚                         â”‚
 â”‚  â”œâ”€ REQ-003 âœ— 65%      â”‚  Red badge (failed)     â”‚                         â”‚
 â”‚  â””â”€ ...                 â”‚                         â”‚                         â”‚
 â”‚                         â”‚                         â”‚                         â”‚
```

---

## Level 3: Component Diagram - Detailed Conversation Flow

### 3.1 Mining Phase Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Mining Conversation Flow                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Configuration.jsx          Master Workflow              ChunkMiner Agent
      â”‚                          â”‚                            â”‚
      â”‚  formData                â”‚                            â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ 1. Initialize              â”‚
      â”‚  - files                 â”‚    Generate session_id     â”‚
      â”‚  - model                 â”‚    correlation_id          â”‚
      â”‚  - chunk_size            â”‚                            â”‚
      â”‚  - chunk_overlap         â”‚ 2. Spawn ChunkMiner        â”‚
      â”‚  - use_llm_kg            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
      â”‚  - correlation_id        â”‚    Context: {              â”‚
      â”‚                          â”‚      files: [...],         â”‚
      â”‚                          â”‚      chunk_size,           â”‚
      â”‚                          â”‚      neighbor_refs         â”‚
      â”‚                          â”‚    }                       â”‚
      â”‚                          â”‚                            â”‚
      â”‚                          â”‚                            â”‚ 3. Extract Text
      â”‚                          â”‚                            â”‚    (PDF/DOCX)
      â”‚                          â”‚                            â”‚
      â”‚                          â”‚                            â”‚ 4. Chunk Document
      â”‚                          â”‚                            â”‚    (overlap chunks)
      â”‚                          â”‚                            â”‚
      â”‚                          â”‚ SSE: chunk_processed       â”‚ 5. Mine Chunks
      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    LLM Call:
ChatInterface.jsx          â”‚ {chunk_index, total}       â”‚    "Extract REQs
      â”‚  Agent message           â”‚                            â”‚     from chunk..."
      â”‚  displayed               â”‚                            â”‚
      â”‚                          â”‚                            â”‚ 6. Parse JSON
      â”‚                          â”‚ SSE: requirement_mined     â”‚    Response
      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚  "ChunkMiner:            â”‚ {req_id, title, tag,       â”‚ 7. Attach Evidence
      â”‚   Found REQ-001"         â”‚  evidence_refs}            â”‚    {sourceFile,
      â”‚                          â”‚                            â”‚     sha1,
      â”‚                          â”‚                            â”‚     chunkIndex}
      â”‚                          â”‚                            â”‚
      â”‚                          â”‚ 8. Heuristic Validation    â”‚
      â”‚                          â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 9. Return Results
      â”‚                          â”‚    3 criteria checked:     â”‚    {items: [...]}
      â”‚                          â”‚    - Has tag               â”‚
      â”‚                          â”‚    - Min length            â”‚
      â”‚                          â”‚    - Has keywords          â”‚
      â”‚                          â”‚                            â”‚
      â”‚                          â”‚ 10. Store in memory        â”‚
      â”‚                          â”‚     requirements_buffer    â”‚
      â”‚                          â”‚                            â”‚
```

### 3.2 Clarification Flow Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Clarification Conversation Flow                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Master Agent              Backend Service            ClarificationModal.jsx
      â”‚                          â”‚                            â”‚
      â”‚ 1. Detect Ambiguity      â”‚                            â”‚
      â”‚    "security level"      â”‚                            â”‚
      â”‚    mentioned without     â”‚                            â”‚
      â”‚    specification         â”‚                            â”‚
      â”‚                          â”‚                            â”‚
      â”‚ 2. Generate Question     â”‚                            â”‚
      â”‚    {                     â”‚                            â”‚
      â”‚      question: "Which    â”‚                            â”‚
      â”‚      security level?",   â”‚                            â”‚
      â”‚      context: {...},     â”‚                            â”‚
      â”‚      options: [...]      â”‚                            â”‚
      â”‚    }                     â”‚                            â”‚
      â”‚                          â”‚                            â”‚
      â”‚ 3. Emit SSE Event        â”‚                            â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ SSE: clarification_needed â”‚
      â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ 4. Modal Opens
      â”‚                          â”‚ {                          â”‚    Automatically
      â”‚                          â”‚   id: "clarify-123",       â”‚
      â”‚                          â”‚   question: "...",         â”‚<â”€â”€â”€â”
      â”‚                          â”‚   context: {...}           â”‚    â”‚
      â”‚ 5. Pause Workflow        â”‚ }                          â”‚    â”‚ User sees:
      â”‚    Save state            â”‚                            â”‚    â”‚ - Question
      â”‚    Wait for response     â”‚                            â”‚    â”‚ - Input field
      â”‚                          â”‚                            â”‚    â”‚ - Context
      â”‚                          â”‚                            â”‚    â””â”€ [Submit]
      â”‚                          â”‚                            â”‚
      â”‚                          â”‚                            â”‚ 6. User Types
      â”‚                          â”‚ POST /api/arch_team/clarifyâ”‚    "ISO 27001
      â”‚                          â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     Level 2"
      â”‚ 7. Receive Input         â”‚ {                          â”‚
      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   clarification_id,        â”‚
      â”‚    {user_input}          â”‚   user_input,              â”‚
      â”‚                          â”‚   session_id               â”‚
      â”‚                          â”‚ }                          â”‚
      â”‚ 8. Resume Workflow       â”‚                            â”‚
      â”‚    Apply context:        â”‚                            â”‚
      â”‚    "security level =     â”‚                            â”‚
      â”‚     ISO 27001 Level 2"   â”‚                            â”‚
      â”‚                          â”‚                            â”‚
      â”‚ 9. Continue Mining       â”‚ SSE: clarification_resolvedâ”‚
      â”‚    with clarification    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ 10. Modal Closes
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ {                          â”‚     Automatically
      â”‚                          â”‚   id: "clarify-123",       â”‚
      â”‚                          â”‚   resolved: true           â”‚
      â”‚                          â”‚ }                          â”‚
      â”‚                          â”‚                            â”‚
      â”‚ 11. Emit Agent Message   â”‚ SSE: agent_message         â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
      â”‚                          â”‚ "Processing with           â”‚
      â”‚                          â”‚  ISO 27001 Level 2..."     â”‚
      â”‚                          â”‚                            â”‚
```

### 3.3 Validation Orchestration Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Validation Orchestration Conversation                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

BatchValidationModal     RequirementOrchestrator     Criterion Specialists
      â”‚                          â”‚                            â”‚
      â”‚ POST /validate/auto      â”‚                            â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ 1. Initialize Session      â”‚
      â”‚ {requirement_id,         â”‚    session_id = "val-xxx"  â”‚
      â”‚  requirement_text,       â”‚    SSE stream setup        â”‚
      â”‚  session_id,             â”‚    iteration = 0           â”‚
      â”‚  threshold: 0.7,         â”‚    max_iterations = 3      â”‚
      â”‚  max_iterations: 3}      â”‚                            â”‚
      â”‚                          â”‚                            â”‚
      â”‚                          â”‚ 2. Iterate: For i in       â”‚
      â”‚                          â”‚    range(max_iterations)   â”‚
      â”‚                          â”‚                            â”‚
      â”‚                          â”‚ 3. Spawn SpecificityAgent  â”‚
      â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
      â”‚                          â”‚    Context: {              â”‚ Specificity
      â”‚                          â”‚      requirement_text,     â”‚ Agent
      â”‚                          â”‚      criterion_def,        â”‚
      â”‚                          â”‚      examples              â”‚ 1. Evaluate
      â”‚                          â”‚    }                       â”‚    LLM Call:
      â”‚                          â”‚                            â”‚    "Rate 0-1"
      â”‚                          â”‚                            â”‚
      â”‚                          â”‚ 4. Receive Score           â”‚ 2. Score: 0.42
      â”‚                          â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    (FAIL)
      â”‚                          â”‚    {score: 0.42,           â”‚
      â”‚                          â”‚     feedback: "..."}       â”‚ 3. Generate Fix
      â”‚                          â”‚                            â”‚    LLM Call:
      â”‚                          â”‚                            â”‚    "Improve text"
      â”‚                          â”‚                            â”‚
      â”‚                          â”‚ 5. Receive Fix             â”‚ 4. Return Fix
      â”‚                          â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    {new_text,
      â”‚ SSE: requirement_updated â”‚    {new_text,              â”‚     reasoning}
      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     old_text}              â”‚
      â”‚ {criterion:              â”‚                            â”‚
      â”‚  "Specificity",          â”‚ 6. Apply Fix               â”‚
      â”‚  old_text: "...",        â”‚    requirement_text =      â”‚
      â”‚  new_text: "...",        â”‚    new_text                â”‚
      â”‚  score_before: 0.42,     â”‚                            â”‚
      â”‚  score_after: 0.85}      â”‚ 7. Re-evaluate             â”‚
      â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ 5. Re-check
      â”‚                          â”‚                            â”‚    Score: 0.85
      â”‚                          â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    (PASS)
      â”‚                          â”‚                            â”‚
      â”‚ Display Diff             â”‚ 8. Spawn TestabilityAgent  â”‚
      â”‚ Show score improvement   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
      â”‚                          â”‚                            â”‚ Testability
      â”‚                          â”‚ [Repeat for all 10         â”‚ Agent
      â”‚                          â”‚  criterion agents]         â”‚ [Same flow]
      â”‚                          â”‚                            â”‚
      â”‚                          â”‚ 9. Check Atomic Criterion  â”‚
      â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ Atomic Agent
      â”‚                          â”‚                            â”‚
      â”‚                          â”‚ 10. SPLIT DETECTED!        â”‚ 1. Detect:
      â”‚                          â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    "Contains
      â”‚                          â”‚     {split_required: true, â”‚     AND/OR"
      â”‚                          â”‚      new_requirements: [   â”‚
      â”‚                          â”‚        {text: "...",       â”‚ 2. Split Logic
      â”‚                          â”‚         req_id_suffix},    â”‚    LLM Call:
      â”‚                          â”‚        {...}               â”‚    "Separate
      â”‚                          â”‚      ]}                    â”‚     into atomic"
      â”‚                          â”‚                            â”‚
      â”‚ SSE: requirement_split   â”‚ 11. Generate New IDs       â”‚ 3. Return Parts
      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     REQ-001-A, REQ-001-B   â”‚    [{text_a},
      â”‚ {original_id: "REQ-001", â”‚                            â”‚     {text_b}]
      â”‚  new_requirement_ids: [  â”‚ 12. Store Split Metadata   â”‚
      â”‚    "REQ-001-A",          â”‚     split_from = "REQ-001" â”‚
      â”‚    "REQ-001-B"           â”‚     split_occurred = true  â”‚
      â”‚  ]}                      â”‚                            â”‚
      â”‚                          â”‚                            â”‚
      â”‚ Show split indicator     â”‚ 13. Calculate Final Score  â”‚
      â”‚                          â”‚     avg(all_criterion_     â”‚
      â”‚                          â”‚     scores)                â”‚
      â”‚                          â”‚                            â”‚
      â”‚ SSE: validation_complete â”‚ 14. Check Threshold        â”‚
      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     final_score >= 0.7?    â”‚
      â”‚ {requirement_id,         â”‚     YES â†’ passed = true    â”‚
      â”‚  final_score: 0.88,      â”‚                            â”‚
      â”‚  passed: true,           â”‚ 15. Persist to DB          â”‚
      â”‚  total_fixes: 5,         â”‚     validation_history     â”‚
      â”‚  split_occurred: true}   â”‚     table                  â”‚
      â”‚                          â”‚                            â”‚
      â”‚ Move to next requirement â”‚ 16. Cleanup Session        â”‚
      â”‚                          â”‚     Close SSE stream       â”‚
      â”‚                          â”‚                            â”‚
```

---

## Level 4: Code Diagram - Key Conversation Handlers

### 4.1 Frontend SSE Event Handlers

```javascript
// ChatInterface.jsx - Agent Message Stream
useEffect(() => {
  const eventSource = new EventSource(
    `/api/arch_team/stream/${sessionId}`
  )

  // 1. Agent conversation messages
  eventSource.addEventListener('agent_message', (e) => {
    const data = JSON.parse(e.data)
    // data: {agent: "ChunkMiner", message: "Found REQ-001", timestamp}
    addMessage(data.agent, data.message)
  })

  // 2. Mining progress updates
  eventSource.addEventListener('requirement_mined', (e) => {
    const data = JSON.parse(e.data)
    // data: {req_id, title, tag, evidence_refs}
    updateRequirementsList(data)
  })

  // 3. Knowledge graph construction
  eventSource.addEventListener('kg_node_added', (e) => {
    const data = JSON.parse(e.data)
    // data: {node_id, label, type}
    addNodeToGraph(data)
  })

  return () => eventSource.close()
}, [sessionId])
```

```javascript
// ClarificationModal.jsx - User Input Handling
useEffect(() => {
  const eventSource = new EventSource(
    `/api/arch_team/stream/${sessionId}`
  )

  // 4. Clarification request from Master Agent
  eventSource.addEventListener('clarification_needed', (e) => {
    const data = JSON.parse(e.data)
    // data: {id: "clarify-123", question: "...", context: {...}}
    setClarification({
      id: data.id,
      question: data.question,
      context: data.context,
      isOpen: true
    })
  })

  // 5. Clarification resolved by user
  eventSource.addEventListener('clarification_resolved', (e) => {
    const data = JSON.parse(e.data)
    // data: {id: "clarify-123", resolved: true}
    if (data.id === clarification.id) {
      setClarification({ ...clarification, isOpen: false })
    }
  })

  return () => eventSource.close()
}, [sessionId])

// User submits clarification
const handleSubmitClarification = async (userInput) => {
  await fetch('/api/arch_team/clarify', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      clarification_id: clarification.id,
      user_input: userInput,
      session_id: sessionId
    })
  })
}
```

```javascript
// BatchValidationModal.jsx - Validation Progress
useEffect(() => {
  const eventSource = new EventSource(
    `/api/v1/validation/stream/${sessionId}`
  )

  // 6. Criterion fix applied
  eventSource.addEventListener('requirement_updated', (e) => {
    const data = JSON.parse(e.data)
    // data: {requirement_id, criterion, old_text, new_text,
    //        score_before, score_after}
    addEvent('update', `Fixed ${data.criterion}: ${
      data.score_before.toFixed(2)} â†’ ${data.score_after.toFixed(2)}`)
    addDiff(data)
  })

  // 7. Requirement split into multiple
  eventSource.addEventListener('requirement_split', (e) => {
    const data = JSON.parse(e.data)
    // data: {original_id, new_requirement_ids: [...]}
    addEvent('split', `Split into ${data.new_requirement_ids.length}
      requirements: ${data.new_requirement_ids.join(', ')}`)
  })

  // 8. Single requirement validation complete
  eventSource.addEventListener('validation_complete', (e) => {
    const data = JSON.parse(e.data)
    // data: {requirement_id, final_score, passed, total_fixes,
    //        split_occurred}
    addEvent('complete', `Completed ${data.requirement_id}:
      Score ${(data.final_score * 100).toFixed(0)}%
      (${data.passed ? 'PASS' : 'FAIL'})`)

    addResult({
      req_id: data.requirement_id,
      passed: data.passed,
      score: data.final_score,
      fixes: data.total_fixes,
      split: data.split_occurred
    })

    // Move to next requirement
    currentIndexRef.current += 1
    if (currentIndexRef.current < requirements.length) {
      validateNext()
    } else {
      setStatus('completed')
    }
  })

  return () => eventSource.close()
}, [sessionId])

// Sequential validation orchestration
const validateNext = async () => {
  const req = requirements[currentIndexRef.current]
  setCurrentRequirement(req)

  // 9. Trigger validation for single requirement
  const response = await fetch('/api/v1/validate/auto', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      requirement_id: req.req_id,
      requirement_text: req.title,
      session_id: sessionId,
      threshold: 0.7,
      max_iterations: 3
    })
  })

  // SSE events will drive the rest of the flow
}
```

### 4.2 Backend Conversation Controllers

```python
# arch_team/service.py - Master Workflow Orchestration

@app.post("/api/arch_team/process")
async def process_requirements(files: List[UploadFile],
                               correlation_id: str,
                               model: str = "gpt-4o-mini"):
    """Master workflow conversation orchestrator"""

    # 1. Initialize session
    session_id = correlation_id or generate_session_id()
    sse_manager.create_session(session_id)

    # 2. Spawn ChunkMiner Agent (Mining conversation)
    chunk_miner = ChunkMinerAgent(
        source="web",
        default_model=model,
        session_id=session_id,
        sse_manager=sse_manager
    )

    # Agent emits messages during processing
    requirements = await chunk_miner.mine_files_or_texts_collect(
        files=files,
        neighbor_refs=True
    )
    # SSE events: agent_message, chunk_processed, requirement_mined

    # 3. Check for clarifications needed
    clarifications = detect_ambiguities(requirements)
    if clarifications:
        # Emit clarification request
        await sse_manager.emit(session_id, "clarification_needed", {
            "id": f"clarify-{uuid.uuid4()}",
            "question": clarifications[0]["question"],
            "context": clarifications[0]["context"]
        })

        # Pause workflow, wait for user input
        user_input = await wait_for_clarification(session_id)

        # Resume with user input
        requirements = apply_clarification(requirements, user_input)

        # Notify resolution
        await sse_manager.emit(session_id, "clarification_resolved", {
            "id": clarifications[0]["id"],
            "resolved": True
        })

    # 4. Spawn KG Agent (Graph construction conversation)
    kg_agent = KGAbstractionAgent(
        session_id=session_id,
        sse_manager=sse_manager
    )

    kg_data = await kg_agent.run(
        items=requirements,
        options={"use_llm": use_llm_kg}
    )
    # SSE events: kg_node_added, kg_edge_added

    # 5. Heuristic validation (fast, 3 criteria)
    validation_results = heuristic_validate_batch(requirements)

    # 6. Return complete results
    return {
        "success": True,
        "requirements": requirements,
        "kg_data": kg_data,
        "validation_results": validation_results
    }


@app.post("/api/arch_team/clarify")
async def handle_clarification(clarification_id: str,
                               user_input: str,
                               session_id: str):
    """Process user clarification input"""

    # Store user input for waiting workflow
    clarification_store[clarification_id] = user_input

    # Signal workflow to resume
    clarification_event[clarification_id].set()

    return {"success": True, "id": clarification_id}


async def wait_for_clarification(session_id: str,
                                 clarification_id: str) -> str:
    """Async wait for user to provide clarification"""

    # Wait with timeout (e.g., 5 minutes)
    event = clarification_event[clarification_id]
    await asyncio.wait_for(event.wait(), timeout=300)

    # Retrieve user input
    user_input = clarification_store.pop(clarification_id)

    return user_input
```

```python
# backend/routers/validate_router.py - Validation Conversation

@router.post("/api/v1/validate/auto")
async def auto_validate_requirement(req: ValidateRequest):
    """Orchestrate validation conversation with 10 criterion agents"""

    # 1. Initialize orchestrator
    orchestrator = RequirementOrchestrator(
        session_id=req.session_id,
        sse_manager=sse_manager,
        threshold=req.threshold,
        max_iterations=req.max_iterations
    )

    # 2. Create validation session in database
    validation_id = persistence_service.create_validation_session(
        requirement_id=req.requirement_id,
        initial_text=req.requirement_text,
        threshold=req.threshold,
        max_iterations=req.max_iterations,
        session_id=req.session_id
    )

    # 3. Run iterative validation conversation
    result = await orchestrator.validate_and_fix(
        requirement_id=req.requirement_id,
        requirement_text=req.requirement_text
    )
    # SSE events during processing:
    # - requirement_updated (per criterion fix)
    # - requirement_split (if atomic violation)
    # - agent_message (specialist agent communication)

    # 4. Persist results
    persistence_service.complete_validation_session(
        validation_id=validation_id,
        final_text=result.final_text,
        final_score=result.final_score,
        passed=result.passed,
        total_iterations=result.total_iterations,
        total_fixes=result.total_fixes,
        split_occurred=result.split_occurred
    )

    # 5. Emit completion event
    await sse_manager.emit(req.session_id, "validation_complete", {
        "requirement_id": req.requirement_id,
        "final_score": result.final_score,
        "passed": result.passed,
        "total_fixes": result.total_fixes,
        "split_occurred": result.split_occurred,
        "final_text": result.final_text
    })

    return {
        "success": True,
        "validation_id": validation_id,
        "requirement_id": req.requirement_id,
        "final_score": result.final_score,
        "passed": result.passed
    }
```

---

## Conversation Patterns Summary

### Pattern 1: Agent Broadcasting
**Purpose**: Agent emits status/progress to frontend in real-time

```
Agent â†’ SSE Event â†’ Frontend
"ChunkMiner: Processing chunk 5/10"
```

**Events**:
- `agent_message` - Agent status updates
- `chunk_processed` - Mining progress
- `requirement_mined` - New requirement extracted
- `kg_node_added` - Graph construction progress

### Pattern 2: User Clarification (Request-Response-Resume)
**Purpose**: Agent pauses workflow to ask user for input

```
Agent â†’ SSE: clarification_needed â†’ Frontend Modal Opens
User Types â†’ POST /clarify â†’ Agent Resumes
Agent â†’ SSE: clarification_resolved â†’ Frontend Modal Closes
```

**Flow**:
1. Agent detects ambiguity during processing
2. Emits SSE event with question
3. Frontend opens modal automatically
4. User provides input, submits
5. Backend stores input, signals agent to resume
6. Agent continues with user's clarification applied

### Pattern 3: Sequential Orchestration (Batch with Progress)
**Purpose**: Process multiple items one-by-one with real-time progress

```
Frontend â†’ For Each Item â†’ POST /validate/auto
Agent â†’ Process â†’ SSE Events (updates, splits, complete)
Frontend â†’ Update Progress â†’ Move to Next Item
```

**Flow**:
1. Frontend maintains queue of items
2. Validates one item at a time
3. SSE events provide real-time feedback
4. On `validation_complete`, move to next
5. Repeat until queue empty

### Pattern 4: Multi-Agent Conversation (Orchestrator + Specialists)
**Purpose**: Coordinate multiple specialist agents in sequence

```
Orchestrator â†’ Spawn Specialist A â†’ Specialist Responds
Orchestrator â†’ Apply Fix â†’ Spawn Specialist B â†’ Specialist Responds
...repeat for all specialists...
Orchestrator â†’ Aggregate Results â†’ Emit Final Event
```

**Flow**:
1. Orchestrator initializes session
2. For each criterion, spawn specialist agent
3. Specialist evaluates, suggests fix
4. Orchestrator applies fix, re-checks
5. All specialists complete â†’ calculate final score
6. Emit `validation_complete` event

---

## Key Conversation Characteristics

### Real-Time Transparency
- Every significant step emits SSE event
- User sees agent "thinking" and "working"
- Progress bars update continuously
- Event logs provide audit trail

### User Control Points
1. **Start Mining** - User uploads files, configures, starts
2. **Clarification Input** - User provides missing context when asked
3. **Fix All Trigger** - User decides when to run expensive validation
4. **Pause/Cancel** - User can stop batch validation mid-process

### Fault Tolerance
- Clarification timeout (5 min) â†’ workflow continues without input
- Validation errors â†’ logged, skip to next requirement
- SSE disconnection â†’ auto-reconnect, resume from last event
- Split failures â†’ log error, mark requirement for manual review

### Cost Awareness
- Heuristic mining: Cheap (keyword-based, no LLM)
- Clarifications: User-driven (no automatic retries)
- Full validation: Expensive (10 LLM agents) â†’ opt-in only
- Batch validation: Transparent cost preview (count Ã— ~$0.05)

---

## Conversation Flow State Machine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   IDLE       â”‚ â† User on landing page
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Upload files, configure
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MINING     â”‚ â† ChunkMiner extracting requirements
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ SSE: agent_message, requirement_mined
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CLARIFYING   â”‚ â† Modal open, waiting for user input
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   (Optional - only if ambiguity detected)
       â”‚ User submits clarification
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ KG_BUILDING  â”‚ â† KGAgent constructing knowledge graph
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ SSE: kg_node_added, kg_edge_added
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ COMPLETED    â”‚ â† Results displayed, queue detected
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ User clicks "Fix All"
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BATCH_VALID  â”‚ â† Modal validating requirements sequentially
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ SSE: requirement_updated, validation_complete
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UPDATED      â”‚ â† Requirements list refreshed with scores
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Summary

This C4 architecture documents the **complete conversation flow** of the requirements mining and validation system:

**Level 1 (Context)**: User interacts with React frontend, which communicates with FastAPI backend and OpenAI LLM via HTTP/SSE.

**Level 2 (Containers)**: Detailed 17-step process from upload â†’ mining â†’ clarification â†’ validation â†’ results, showing all conversation touchpoints.

**Level 3 (Components)**: Three key conversation flows:
- Mining (ChunkMiner â†” Frontend)
- Clarification (Master Agent â†” User via Modal)
- Validation (Orchestrator â†” 10 Specialists â†” Frontend)

**Level 4 (Code)**: Actual SSE event handlers, conversation controllers, and state management showing how messages flow between components.

**Key Patterns**: Agent Broadcasting, User Clarification (Request-Response-Resume), Sequential Orchestration, Multi-Agent Conversation.

The system achieves **real-time transparency**, **user control**, and **cost awareness** through well-designed conversation patterns with SSE streaming, modal-based clarifications, and sequential batch processing.

# Requirements Engineering System - Docker Compose
# Frontend + Backend in single container, Qdrant for vector storage
services:
  app:
    build:
      context: .
      target: production-fastapi
    image: req-orchestrator:latest
    container_name: req-orchestrator
    ports:
      - "${BACKEND_PORT:-8087}:8087"
    env_file:
      - .env
    environment:
      QDRANT_URL: http://qdrant
      QDRANT_PORT: 6333
    volumes:
      - app-data:/app/data
      - app-projects:/app/projects
    healthcheck:
      test: ["CMD", "curl", "-sf", "http://localhost:8087/health"]
      interval: 30s
      timeout: 5s
      retries: 3
    depends_on:
      - qdrant
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:latest
    container_name: qdrant
    ports:
      - "${QDRANT_PORT:-6401}:6333"
    volumes:
      - qdrant-data:/qdrant/storage
    restart: unless-stopped

volumes:
  app-data:
  app-projects:
  qdrant-data:
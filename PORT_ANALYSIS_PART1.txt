================================================================================
GLOBAL PORT CONFIGURATION ANALYSIS
Requirements Engineering System - Multi-Service Architecture
Date: 2025-11-11
================================================================================

EXECUTIVE SUMMARY
================================================================================
- 60+ files contain hardcoded or semi-configured port numbers
- 5 services with inconsistent port naming conventions
- No centralized configuration system
- Multiple conflicting defaults across different files
- Frontend proxy configuration hardcoded in vite.config.js

CURRENT PORT USAGE
================================================================================
Service            | Port | Type      | Current Config Location
Frontend (Vite)    | 3000 | Dev       | vite.config.js line 7 (hardcoded)
Backend (FastAPI)  | 8087 | API       | .env line 6 (also 8081, 8082 variants)
Arch Team (Flask)  | 8000 | API       | arch_team/service.py:1525, APP_PORT env
Agent Worker       | 8090 | FastAPI   | agent_worker/app.py:41, PORT env
Qdrant Vector DB   | 6333 | Primary   | backend/core/settings.py:29
                  | 6401 | Fallback  | Hardcoded in vector_store.py

FILES WITH HARDCODED PORTS - PYTHON FILES (20+ files)
================================================================================

BACKEND CONFIGURATION (CRITICAL)
- backend/core/settings.py
  Line 14: API_PORT default = 8081
  Line 29: QDRANT_PORT default = 6333

- backend/main.py
  Line 151: API_PORT default = 8082 (CONFLICTS with settings.py!)

- backend/core/vector_store.py
  Line 48: Uses QDRANT_PORT from settings
  Line 60-65: Hardcoded fallback logic 6333 → 6401

- backend/__init__.py
  Line 122: Comment hardcodes 'http://localhost:8087'

FASTAPI STARTUP (CRITICAL FOR DEV)
- start_fastapi.py
  Line 112: FASTAPI_PORT=8000 (hardcoded in docstring)
  Line 144-146: URLs hardcoded as 'http://localhost:8000'
  Line 164: table output hardcodes 8000
  Line 203: run_development_server(..., port: int = 8000, ...)
  Line 224: run_production_server(..., port: int = 8000, ...)
  Line 248: argparse default port = 8000

- live_test_fastapi.py
  Line 360-364: Hardcoded URLs and port 8000

- test_live_system.py
  Line 5: base_url = 'http://127.0.0.1:8087'

ARCH TEAM SERVICES (INCONSISTENT NAMING)
- arch_team/service.py
  Line 14: ENV docs say 'APP_PORT' (NOT API_PORT!)
  Line 1525: port = int(os.environ.get('APP_PORT', '8000'))

- arch_team/main.py
  Line 91: Hardcoded 'http://localhost:6333' (Qdrant)

- arch_team/memory/qdrant_kg.py
  Line 57: Hardcoded fallback 'http://localhost:6401'

- arch_team/memory/qdrant_trace_sink.py
  Line 27: Hardcoded 'http://localhost:6333'

- arch_team/memory/retrieval.py
  Line 57-58: Hardcoded fallback 'http://localhost:6401'

- arch_team/pipeline/upload_ingest.py
  Line 82: Hardcoded 'http://localhost:6333'

- arch_team/pipeline/store_requirements.py
  Line 97: Hardcoded 'http://localhost:6333'

AGENT WORKER (MULTIPLE DEFINITIONS)
- agent_worker/app.py
  Line 40: BACKEND_BASE_URL default = 'http://backend:8081'
  Line 41: PORT default = 8090 (uses 'PORT' not 'API_PORT')

TOOLS & UTILITIES
- arch_team/tools/validation_tools.py
  Line 22: API_BASE default = 'http://localhost:8000'

- arch_team/tools/rag_tools.py
  Line 12: API_BASE default = 'http://localhost:8000'

- dev/qdrant_migrate.py
  Line 93: Hardcoded port 6333 in output

DEVELOPMENT SCRIPTS
- scripts/verify_setup.py
  Line 245: Hardcoded QDRANT_PORT = 6401
  Line 253: Hardcoded APP_PORT = 8000

- wsgi.py
  Line 13: port = int(os.environ.get('API_PORT', '8081'))

TESTING
- tests/backend/test_vector_payload_alias.py
  Line 67, 84: Hardcoded mock return 6333

FILES WITH HARDCODED PORTS - JAVASCRIPT/JSX FILES (6 files)
================================================================================

VITE CONFIGURATION (CRITICAL FOR FRONTEND BUILD)
- vite.config.js
  Line 7: port: 3000 (hardcoded)
  Line 10: proxy target 'http://localhost:8000'
  Line 14: proxy target 'http://localhost:8000'
  Line 18: proxy target 'http://localhost:8000'
  Line 22: proxy target 'http://localhost:8000'
  Line 26: proxy target 'http://localhost:8087'
  Line 30: proxy target 'http://localhost:8087'
  
  Issue: 6 hardcoded proxy targets with no env override!

REACT COMPONENTS (use relative URLs - good practice)
- src/components/ChatInterface.jsx
  Line 7: API_BASE = '' (uses Vite proxy correctly)
  
- src/components/ClarificationModal.jsx
- src/components/KnowledgeGraph.jsx
- src/utils/sse-reconnection.js

Note: Some values like 'maxDelay: 30000' and 'nodeRepulsion: 8000' are NOT ports

ENVIRONMENT FILES
================================================================================

.env.example
- Line 6: API_PORT=8087
- Line 34: QDRANT_PORT=6401
- Line 58-59: LEGACY_BASE_URL, V2_BASE_URL hardcoded

.env (current - WARNING: has real API key!)
- Line 6: API_PORT=8000 (CONFLICTS with .env.example's 8087!)
- Line 34: QDRANT_PORT=6401

DOCKER CONFIGURATION
================================================================================

docker-compose.yml
- Line 11: backend port 8087:8087
- Line 26: AGENT environment BACKEND_BASE_URL=http://backend:8087
- Line 32: agent port 8090:8090
- Line 40: frontend port 8081:80

PORT INCONSISTENCIES & CONFLICTS
================================================================================

PROBLEM 1: Inconsistent Environment Variable Naming
Service          | Current Env Var      | Should Be           | Files Affected
Main Backend     | API_PORT (8081)      | ✓ consistent        | backend/core/settings.py
FastAPI Dev      | FASTAPI_PORT (8000)  | Conflicts           | start_fastapi.py
Arch Team        | APP_PORT (8000)      | Should use API_PORT | arch_team/service.py
Agent Worker     | PORT (8090)          | Should be specific  | agent_worker/app.py
Frontend         | (none)               | Should have one     | vite.config.js

PROBLEM 2: Conflicting Default Ports in Different Files
- .env.example API_PORT: 8087
- .env (current) API_PORT: 8000
- backend/core/settings.py default: 8081
- start_fastapi.py default: 8000
- backend/main.py default: 8082 (DIFFERENT!)
= Chaos when files are read in different order

PROBLEM 3: Hardcoded Qdrant Fallback Logic
- Primary port 6333 hardcoded in multiple files
- Fallback port 6401 hardcoded as exception handler
- No env control over which is primary
- Implicit fallback behavior confusing

PROBLEM 4: Hardcoded Service URLs
- vite.config.js: 6 proxy targets with localhost:port hardcoded
- agent_worker/app.py: 'http://backend:8081' hardcoded
- arch_team/tools: Multiple 'http://localhost:8000' defaults
- arch_team/memory: Multiple 'http://localhost:6333' hardcoded

PROBLEM 5: Frontend Configuration
- vite.config.js cannot read .env files
- No environment-based proxy configuration
- Vite port (3000) completely hardcoded
- Proxy targets fixed at build time

PROBLEM 6: Docker vs. Local Dev Confusion
- docker-compose.yml uses 'http://backend:8087' (container DNS)
- But scripts and tests assume 'http://localhost:8087' (host)
- No clear path for switching between modes
- Developers confused about which URLs to use

================================================================================
END PART 1
================================================================================
